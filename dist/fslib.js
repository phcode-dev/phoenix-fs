(()=>{function e(e){return e&&e.__esModule?e.default:e}var t={};const n={ENOENT:"ENOENT",UNKNOWN:"UNKNOWN",OK:"OK",EOF:"EOF",EADDRINFO:"EADDRINFO",EACCES:"EACCES",EAGAIN:"EAGAIN",EADDRINUSE:"EADDRINUSE",EADDRNOTAVAIL:"EADDRNOTAVAIL",EAFNOSUPPORT:"EAFNOSUPPORT",EALREADY:"EALREADY",EBADF:"EBADF",EBUSY:"EBUSY",ECONNABORTED:"ECONNABORTED",ECONNREFUSED:"ECONNREFUSED",ECONNRESET:"ECONNRESET",EDESTADDRREQ:"EDESTADDRREQ",EFAULT:"EFAULT",EHOSTUNREACH:"EHOSTUNREACH",EINTR:"EINTR",EINVAL:"EINVAL",EISCONN:"EISCONN",EMFILE:"EMFILE",EMSGSIZE:"EMSGSIZE",ENETDOWN:"ENETDOWN",ENETUNREACH:"ENETUNREACH",ENFILE:"ENFILE",ENOBUFS:"ENOBUFS",ENOMEM:"ENOMEM",ENOTDIR:"ENOTDIR",EISDIR:"EISDIR",ENONET:"ENONET",ENOTCONN:"ENOTCONN",ENOTSOCK:"ENOTSOCK",ENOTSUP:"ENOTSUP",ENOSYS:"ENOSYS",EPIPE:"EPIPE",EPROTO:"EPROTO",EPROTONOSUPPORT:"EPROTONOSUPPORT",EPROTOTYPE:"EPROTOTYPE",ETIMEDOUT:"ETIMEDOUT",ECHARSET:"ECHARSET",EAIFAMNOSUPPORT:"EAIFAMNOSUPPORT",EAISERVICE:"EAISERVICE",EAISOCKTYPE:"EAISOCKTYPE",ESHUTDOWN:"ESHUTDOWN",EEXIST:"EEXIST",ESRCH:"ESRCH",ENAMETOOLONG:"ENAMETOOLONG",EPERM:"EPERM",ELOOP:"ELOOP",EXDEV:"EXDEV",ENOTEMPTY:"ENOTEMPTY",ENOSPC:"ENOSPC",EIO:"EIO",EROFS:"EROFS",ENODEV:"ENODEV",ESPIPE:"ESPIPE",ECANCELED:"ECANCELED"},r={ENOENT:n.ENOENT,EOF:n.EOF,EACCES:n.EACCES,EAGAIN:n.EAGAIN,EBADF:n.EBADF,EBUSY:n.EBUSY,EINVAL:n.EINVAL,EMFILE:n.EMFILE,ENFILE:n.ENFILE,ENOBUFS:n.ENOBUFS,ENOTDIR:n.ENOTDIR,EISDIR:n.EISDIR,ENOSYS:n.ENOSYS,ECHARSET:n.ECHARSET,EEXIST:n.EEXIST,ENAMETOOLONG:n.ENAMETOOLONG,EPERM:n.EPERM,ELOOP:n.ELOOP,EXDEV:n.EXDEV,ENOTEMPTY:n.ENOTEMPTY,ENOSPC:n.ENOSPC,EIO:n.EIO,EROFS:n.EROFS,ESPIPE:n.ESPIPE,ECANCELED:n.ECANCELED},o=[{errno:-2,code:n.ENOENT,description:"no such file or directory"},{errno:-1,code:n.UNKNOWN,description:"unknown error"},{errno:0,code:n.OK,description:"success"},{errno:1,code:n.EOF,description:"end of file"},{errno:2,code:n.EADDRINFO,description:"getaddrinfo error"},{errno:3,code:n.EACCES,description:"permission denied"},{errno:4,code:n.EAGAIN,description:"resource temporarily unavailable"},{errno:5,code:n.EADDRINUSE,description:"address already in use"},{errno:6,code:n.EADDRNOTAVAIL,description:"address not available"},{errno:7,code:n.EAFNOSUPPORT,description:"address family not supported"},{errno:8,code:n.EALREADY,description:"connection already in progress"},{errno:9,code:n.EBADF,description:"bad file descriptor"},{errno:10,code:n.EBUSY,description:"resource busy or locked"},{errno:11,code:n.ECONNABORTED,description:"software caused connection abort"},{errno:12,code:n.ECONNREFUSED,description:"connection refused"},{errno:13,code:n.ECONNRESET,description:"connection reset by peer"},{errno:14,code:n.EDESTADDRREQ,description:"destination address required"},{errno:15,code:n.EFAULT,description:"bad address in system call argument"},{errno:16,code:n.EHOSTUNREACH,description:"host is unreachable"},{errno:17,code:n.EINTR,description:"interrupted system call"},{errno:18,code:n.EINVAL,description:"invalid argument"},{errno:19,code:n.EISCONN,description:"socket is already connected"},{errno:20,code:n.EMFILE,description:"too many open files"},{errno:21,code:n.EMSGSIZE,description:"message/datagram too long"},{errno:22,code:n.ENETDOWN,description:"network is down"},{errno:23,code:n.ENETUNREACH,description:"network is unreachable"},{errno:24,code:n.ENFILE,description:"file table overflow"},{errno:25,code:n.ENOBUFS,description:"no buffer space available"},{errno:26,code:n.ENOMEM,description:"not enough memory/ high virtual memory usage"},{errno:27,code:n.ENOTDIR,description:"not a directory"},{errno:28,code:n.EISDIR,description:"illegal operation on a directory"},{errno:29,code:n.ENONET,description:"machine is not on the network"},{errno:31,code:n.ENOTCONN,description:"socket is not connected"},{errno:32,code:n.ENOTSOCK,description:"socket operation on non-socket"},{errno:33,code:n.ENOTSUP,description:"operation not supported on socket"},{errno:34,code:n.ENOENT,description:"no such file or directory"},{errno:35,code:n.ENOSYS,description:"function not implemented"},{errno:36,code:n.EPIPE,description:"broken pipe"},{errno:37,code:n.EPROTO,description:"protocol error"},{errno:38,code:n.EPROTONOSUPPORT,description:"protocol not supported"},{errno:39,code:n.EPROTOTYPE,description:"protocol wrong type for socket"},{errno:40,code:n.ETIMEDOUT,description:"connection timed out"},{errno:41,code:n.ECHARSET,description:"invalid Unicode character"},{errno:42,code:n.EAIFAMNOSUPPORT,description:"address family for hostname not supported"},{errno:44,code:n.EAISERVICE,description:"servname not supported for ai_socktype"},{errno:45,code:n.EAISOCKTYPE,description:"ai_socktype not supported"},{errno:46,code:n.ESHUTDOWN,description:"cannot send after transport endpoint shutdown"},{errno:47,code:n.EEXIST,description:"file already exists"},{errno:48,code:n.ESRCH,description:"no such process"},{errno:49,code:n.ENAMETOOLONG,description:"name too long"},{errno:50,code:n.EPERM,description:"operation not permitted"},{errno:51,code:n.ELOOP,description:"too many symbolic links encountered"},{errno:52,code:n.EXDEV,description:"cross-device link not permitted"},{errno:53,code:n.ENOTEMPTY,description:"directory not empty"},{errno:54,code:n.ENOSPC,description:"no space left on device"},{errno:55,code:n.EIO,description:"i/o error"},{errno:56,code:n.EROFS,description:"read-only file system"},{errno:57,code:n.ENODEV,description:"no such device"},{errno:58,code:n.ESPIPE,description:"invalid seek"},{errno:59,code:n.ECANCELED,description:"operation canceled"}];let i={},a={};o.forEach((function(e){i[e.errno]=e,a[e.code]=e}));const s={ERROR_CODES:n,FS_ERROR_CODES:r,ALL_ERRORS:o,ERRNO_TO_ERROR_MAP:i,CODE_TO_ERROR_MAP:a},c={};["3:EACCES:permission denied","9:EBADF:bad file descriptor","10:EBUSY:resource busy or locked","18:EINVAL:invalid argument","27:ENOTDIR:not a directory","28:EISDIR:illegal operation on a directory","34:ENOENT:no such file or directory","35:ENOSYS:function not implemented","47:EEXIST:file already exists","50:EPERM:operation not permitted","51:ELOOP:too many symbolic links encountered","53:ENOTEMPTY:directory not empty","55:EIO:i/o error","1000:ENOTMOUNTED:not mounted","1001:EFILESYSTEMERROR:missing super node, use 'FORMAT' flag to format filesystem.","1002:ENOATTR:attribute does not exist"].forEach((function(e){var t=+(e=e.split(":"))[0],n=e[1],r=e[2];function o(e,o){Error.call(this),this.name=n,this.code=n,this.errno=t,this.message=e||r,o&&(this.path=o),this.stack=new Error(this.message).stack}o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o.prototype.toString=function(){var e=this.path?", '"+this.path+"'":"";return this.name+": "+this.message+e},c[n]=c[t]=o})),t={ERR_CODES:s,Errors:c};var u;u={Constants:{MOUNT_DEVICE_NAME:"nativeFsAccess",KIND_FILE:"file",KIND_DIRECTORY:"directory",NODE_TYPE_FILE:"FILE",NODE_TYPE_DIRECTORY:"DIRECTORY",IDB_RW_TYPE:"readwrite",MOUNT_POINT_ROOT:"/mnt"}};const E="FS_ACCESS",l="MOUNT_POINTS";let d=null,f={};async function h(){d||(d=await idb.openDB("PHOENIX_MOUNTS",1,{upgrade(e){e.createObjectStore(E)}}))}var p={addMountPoint:async function(t,n){await h();const r=d.transaction(E,e(u).IDB_RW_TYPE),o=r.objectStore(E);f=await o.get(l)||{},f[t]=n,await o.put(f,l),await r.done},getMountPoints:function(){return f},refreshMountPoints:async function(){await h();const t=d.transaction(E,e(u).IDB_RW_TYPE),n=t.objectStore(E);return f=await n.get(l)||{},await t.done,f}};const O="PHOENIX_MOUNT_POINT_CHANGED_NOTIFICATION";let N=null;function w(){N||("undefined"!=typeof BroadcastChannel?N=new BroadcastChannel(O):console.warn("window.BroadcastChannel not supported. Mount point changes wont reflect across tabs."))}function m(t){return new Promise((n=>{let r=function(e){let t=[];const n=p.getMountPoints();for(const[r,o]of Object.entries(n))t.push(new Promise((t=>{const n=o.isSameEntry(e),i=o.resolve(e);Promise.all([n,i]).then((e=>{let n=e[0]||!1,o=e[1]||[];t({existingMountName:r,isSameEntry:n,subPath:o.join("/")})}))})));return t}(t);Promise.all(r).then((t=>{for(let r=0;r<t.length;r++){let o=t[r].existingMountName;if(t[r].isSameEntry)return void n(`${e(u).MOUNT_POINT_ROOT}/${o}`);if(t[r].subPath.length>=1)return void n(`${e(u).MOUNT_POINT_ROOT}/${o}/${t[r].subPath}`)}n(null)}))}))}function T(t){return new Promise((async(n,r)=>{let o=await m(t);if(o)n(o);else{let o=function(e){let t=e.name;const n=p.getMountPoints();if(!n[t])return t;for(let e=0;e<1e6;e++){let r=`${t}_${e}`;if(!n[r])return r}}(t);o?(await p.addMountPoint(o,t),n(`${e(u).MOUNT_POINT_ROOT}/${o}`)):r("Mount name not fount")}}))}async function y(e,n,r,o){let i=n.length;if(r===i)o(null,e);else{let a=n[r],s=null,c=null;try{s=await e.getDirectoryHandle(a)}catch(e){}try{c=await e.getFileHandle(a)}catch(e){}if(c&&r===i-1)o(null,c);else if(s)y(s,n,r+1,o);else{let e=n.join("/");o(new t.Errors.ENOENT("File/Dir does not exist: ",e))}}}function g(e,n){const r=e.split("/"),o=p.getMountPoints();(r.length<3||""!==r[0]||"mnt"!==r[1])&&n(new t.Errors.EINVAL("Cannot operate on path "+e));let i=o[r[2]];i?async function(e,t){const n={mode:"read"};try{let r=await e.queryPermission(n);if("granted"===r)return void t(!0);r=await e.requestPermission(n),t("granted"===r)}catch(e){t(!1)}}(i,(o=>{o?y(i,r,3,n):n(new t.Errors.EACCES("permission denied on path: "+e))})):n(new t.Errors.ENOENT("Path does not exist: ",e))}w(),N.onmessage=async function(e){e.data===O&&await p.refreshMountPoints()};var I={mountNativeFolder:function(e,n){n||(n=e,e=null);let r=null,o=null;p.refreshMountPoints().then((()=>e||window.showDirectoryPicker())).then((e=>T(e))).then((e=>r=e)).then((()=>(w(),void N.postMessage(O)))).catch((function(e){o=new t.Errors.ENOTMOUNTED(e)})).finally((()=>{if(n)n(o,[r]);else if(o)throw new t.Errors.ENOTMOUNTED(o)}))},isMountPath:function(t){return"string"==typeof t&&!(!t||(t=window.path.normalize(t))!==e(u).MOUNT_POINT_ROOT)},isMountSubPath:function(e){if("string"!=typeof e)return!1;let t="/mnt/";return!!(e&&(e=window.path.normalize(e)).startsWith(t)&&e.length>t.length)},getHandleFromPath:g,getMountPoints:function(){return p.getMountPoints()},refreshMountPoints:function(){return p.refreshMountPoints()},getHandleFromPathIfPresent:async function(e){return new Promise((t=>{g(e,((e,n)=>{t(e?null:n)}))}))}};function R(e){return null==e?null:new Date(Number(e))}function S(e,t,n){this.dev=n,this.node=t.id,this.type=t.type,this.size=t.size,this.nlinks=t.nlinks,this.atime=R(t.atime),this.mtime=R(t.mtime),this.ctime=R(t.ctime),this.atimeMs=t.atime,this.mtimeMs=t.mtime,this.ctimeMs=t.ctime,this.version=t.version,this.mode=t.mode,this.name=window.path.basename(e)}function P(t){switch(t.kind){case e(u).KIND_FILE:return e(u).NODE_TYPE_FILE;case e(u).KIND_DIRECTORY:return e(u).NODE_TYPE_DIRECTORY;default:return null}}S.prototype.isFile=function(){return this.type===e(u).NODE_TYPE_FILE},S.prototype.isDirectory=function(){return this.type===e(u).NODE_TYPE_DIRECTORY},S.prototype.isSymbolicLink=function(){return this.type===e(u).NODE_TYPE_SYMBOLIC_LINK},S.prototype.isSocket=S.prototype.isFIFO=S.prototype.isCharacterDevice=S.prototype.isBlockDevice=function(){return!1};var D={createStatObject:async function(t,n){let r=await async function(t){let n=null,r={};switch(t.kind){case e(u).KIND_FILE:return n=await t.getFile(),r.size=n.size,r.mtime=n.lastModified,r;case e(u).KIND_DIRECTORY:default:return r}}(n);return new S(t,{type:P(n),size:r.size,mtime:r.mtime},e(u).MOUNT_DEVICE_NAME)}};async function b(e,n,r){try{let t=await e.getDirectoryHandle(n,{create:!0});return r&&r(null),t}catch(e){throw r&&r(new t.Errors.EIO("Filer native fs function not yet supported.",e)),new t.Errors.EIO("Filer native fs function not yet supported.",e)}}async function A(e,n,r){n=n||"utf-8";try{let o=await e.getFile(),i=await o.arrayBuffer();if(n===Y)return void r(null,i,n);let a=function(e,t){try{return new TextDecoder(t).decode(e)}catch(e){return null}}(i,n);null!==a?r(null,a,n):r(new t.Errors.EIO(`Encoding ${n} no supported`))}catch(e){r(e)}}function C(e,t,n){return e?"function"==typeof e?e={encoding:t,flag:n}:"string"==typeof e&&(e={encoding:e,flag:n}):e={encoding:t,flag:n},e}async function v(e,t,n,r,o){try{const n=await e.getFileHandle(t,{create:!0}),i=await n.createWritable();await i.write(r),await i.close(),o(null)}catch(e){o(e)}}async function F(e,t){e=window.path.normalize(e);let n=window.path.dirname(e),r=window.path.basename(e);I.getHandleFromPath(n,(async(e,n)=>{e?t(e):async function(e,t,n,r=!0){try{await e.removeEntry(t,{recursive:r}),n(null)}catch(e){n(e)}}(n,r,t)}))}async function _(n,r,o){return new Promise((async(i,a)=>{n=window.path.normalize(n);let s=window.path.dirname(n),c=window.path.basename(n),E=await I.getHandleFromPathIfPresent(n),l=await I.getHandleFromPathIfPresent(s);if(E&&E.kind===e(u).KIND_FILE)a(new t.Errors.EEXIST(`Destination file already exists: ${n}`));else if(E&&E.kind===e(u).KIND_DIRECTORY&&o===e(u).KIND_FILE){i(await E.getFileHandle(r,{create:!0}))}else if(E&&E.kind===e(u).KIND_DIRECTORY&&o===e(u).KIND_DIRECTORY){if(await I.getHandleFromPathIfPresent(`${n}/${r}`))return void a(new t.Errors.EEXIST(`Copy destination already exists: ${n}/${r}`));i(await E.getDirectoryHandle(r,{create:!0}))}else if(!E&&l&&l.kind===e(u).KIND_DIRECTORY&&o===e(u).KIND_FILE){i(await l.getFileHandle(c,{create:!0}))}else if(!E&&l&&l.kind===e(u).KIND_DIRECTORY&&o===e(u).KIND_DIRECTORY){i(await l.getDirectoryHandle(c,{create:!0}))}else a(new t.Errors.ENOENT(`Copy destination doesnt exist: ${n}`))}))}async function M(e,t,n){try{n&&(t=await t.getFileHandle(n,{create:!0}));const r=await e.getFile(),o=await r.stream(),i=await t.createWritable();await o.pipeTo(i)}catch(e){throw console.error(`Error while copying ${t.name}/${n} : ${e}`),e}}async function k(t,n,r){let o=[];for await(const[i,a]of t.entries())if(a.kind===e(u).KIND_FILE)o.push(M(a,n,i));else if(a.kind===e(u).KIND_DIRECTORY){const e=await b(n,i);r&&e&&o.push(k(a,e,r))}await Promise.all(o)}async function L(t,n,r,o,i){try{let a=await _(n,r,e(u).KIND_DIRECTORY);await k(t,a,i),o(null)}catch(e){o(e)}}async function U(n,r,o,i=!0){let a=window.path.normalize(n),s=window.path.basename(a);I.getHandleFromPath(a,(async(n,c)=>{if(n)o(n);else{if(c.kind===e(u).KIND_FILE)return async function(t,n,r,o){try{let i=await _(n,r,e(u).KIND_FILE);await M(t,i),o(null)}catch(e){o(e)}}(c,r,s,o);if(c.kind===e(u).KIND_DIRECTORY)return L(c,r,s,o,i);o(new t.Errors.EIO(`Cannot copy src: ${a}`))}}))}const Y="byte-array";var $={mountNativeFolder:function(...e){I.mountNativeFolder(...e)},refreshMountPoints:function(){I.refreshMountPoints()},mkdir:function(n,r,o){arguments.length<4&&(o=r),n=window.path.normalize(n);let i=window.path.dirname(n),a=window.path.basename(n);I.getHandleFromPath(i,((n,r)=>{n?o(n):r.kind===e(u).KIND_FILE?o(new t.Errors.ENOTDIR("Parent path is not a directory.")):b(r,a,o)}))},readdir:function(n,r,o){if(n=window.path.normalize(n),"function"!=typeof r)throw new t.Errors.ENOSYS("Filer readdir options are not yet supported");if(o=r,n===e(u).MOUNT_POINT_ROOT){let e=Object.keys(I.getMountPoints());o(null,e)}else I.getHandleFromPath(n,((n,r)=>{n?o(n):r.kind===e(u).KIND_FILE?o(new t.Errors.ENOTDIR("Path is not a directory.")):async function(e,t){let n=[];for await(const[t]of e.entries())n.push(t);t&&t(null,n)}(r,o)}))},stat:function(e,t){e=window.path.normalize(e),I.getHandleFromPath(e,((n,r)=>{n?t(n):D.createStatObject(e,r).then((e=>{t(null,e)})).catch((e=>{t(e)}))}))},readFile:function(n,r,o){n=window.path.normalize(n),o=arguments[arguments.length-1],r=C(r,null,"r"),I.getHandleFromPath(n,((n,i)=>{n?o(n):i.kind===e(u).KIND_DIRECTORY?o(new t.Errors.EISDIR("Path is a directory.")):A(i,r.encoding,o)}))},writeFile:function(n,r,o,i){i=arguments[arguments.length-1],o=C(o,"utf8","w"),buffer.Buffer.isBuffer(r)||("number"==typeof r&&(r=""+r),r="string"!=typeof(r=r||"")?buffer.Buffer.from(r.toString()):buffer.Buffer.from(r||"",o.encoding||"utf8")),n=window.path.normalize(n);let a=window.path.dirname(n),s=window.path.basename(n);I.getHandleFromPath(a,((n,a)=>{n?i(n):a.kind===e(u).KIND_FILE?i(new t.Errors.ENOTDIR("Parent path is not a directory.")):v(a,s,o.encoding,r,i)}))},unlink:F,copy:U,rename:async function(e,t,n){U(e,t,(t=>{t?n(t):setTimeout((()=>{F(e,n)}),0)}))},BYTE_ARRAY_ENCODING:Y};let H=null,B=[];var K={};define((function(e,t,n,r){n.exports=function(e,t){var n={dot:!0,noext:!0};"/"!==e[e.length-1]&&(n.matchBase=!0);return t=t.replace(/\*\*/g,"{*,**/**/**}"),d(e,t,n)},d.Minimatch=f;var o=d.cache=new function(){var e={},t=0;this.set=function(n,r){++t>=100&&(e={}),e[n]=r},this.get=function(t){return e[t]}}({max:100}),i=d.GLOBSTAR=f.GLOBSTAR={},a=function(e){var t=(e=e.split(/[\/\\]/)).pop();return t||(t=e.pop()),t},s="[^/]",c="[^/]*?",u="().*{}+?[]^$\\!".split("").reduce((function(e,t){return e[t]=!0,e}),{});var E=/\/+/;function l(e,t){e=e||{},t=t||{};var n={};return Object.keys(t).forEach((function(e){n[e]=t[e]})),Object.keys(e).forEach((function(t){n[t]=e[t]})),n}function d(e,t,n){if("string"!=typeof t)throw new TypeError("glob pattern string required");return n||(n={}),!(!n.nocomment&&"#"===t.charAt(0))&&(""===t.trim()?""===e:new f(t,n).match(e))}function f(e,t){if(!(this instanceof f))return new f(e,t,o);if("string"!=typeof e)throw new TypeError("glob pattern string required");t||(t={}),e=e.trim(),"win32"===r&&(e=e.split("\\").join("/"));var n,i=e+"\n"+(n=t,JSON.stringify(n)),a=d.cache.get(i);if(a)return a;d.cache.set(i,this),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}d.monkeyPatch=function(){var e=Object.getOwnPropertyDescriptor(String.prototype,"match"),t=e.value;e.value=function(e){return e instanceof f?e.match(this):t.call(this,e)},Object.defineProperty(String.prototype,e)},d.filter=function(e,t){return t=t||{},function(n,r,o){return d(n,e,t)}},d.defaults=function(e){if(!e||!Object.keys(e).length)return d;var t=d,n=function(n,r,o){return t.minimatch(n,r,l(e,o))};return n.Minimatch=function(n,r){return new t.Minimatch(n,l(e,r))},n},f.defaults=function(e){return e&&Object.keys(e).length?d.defaults(e).Minimatch:f},f.prototype.make=function(){if(this._made)return;var e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate();var n=this.globSet=this.braceExpand();t.debug&&console.error(this.pattern,n);n=this.globParts=n.map((function(e){return e.split(E)})),t.debug&&console.error(this.pattern,n);n=n.map((function(e,t,n){return e.map(this.parse,this)}),this),t.debug&&console.error(this.pattern,n);n=n.filter((function(e){return-1===e.indexOf(!1)})),t.debug&&console.error(this.pattern,n);this.set=n},f.prototype.parseNegate=function(){var e=this.pattern,t=!1,n=this.options,r=0;if(n.nonegate)return;for(var o=0,i=e.length;o<i&&"!"===e.charAt(o);o++)t=!t,r++;r&&(this.pattern=e.substr(r));this.negate=t},d.braceExpand=function(e,t){return new f(e,t).braceExpand()},f.prototype.braceExpand=function e(t,n){if(n=n||this.options,void 0===(t=void 0===t?this.pattern:t))throw new Error("undefined pattern");if(n.nobrace||!t.match(/\{.*\}/))return[t];var r=!1;if("{"!==t.charAt(0)){for(var o=null,i=0,a=t.length;i<a;i++){if("\\"===(m=t.charAt(i)))r=!r;else if("{"===m&&!r){o=t.substr(0,i);break}}if(null===o)return[t];var s=e(t.substr(i),n);return s.map((function(e){return o+e}))}var c=t.match(/^\{(-?[0-9]+)\.\.(-?[0-9]+)\}/);if(c){var u=e(t.substr(c[0].length),n),E=+c[1],l=+c[2],d=E>l?-1:1,f=[];for(i=E;i!=l+d;i+=d)for(var h=0,p=u.length;h<p;h++)f.push(i+u[h]);return f}i=1;var O=1,N=(f=[],"");r=!1;function w(){f.push(N),N=""}e:for(i=1,a=t.length;i<a;i++){var m=t.charAt(i);if(r)r=!1,N+="\\"+m;else switch(m){case"\\":r=!0;continue;case"{":O++,N+="{";continue;case"}":if(0===--O){w(),i++;break e}N+=m;continue;case",":1===O?w():N+=m;continue;default:N+=m;continue}}if(0!==O)return e("\\"+t,n);u=e(t.substr(i),n);var T=1===f.length;f=f.map((function(t){return e(t,n)})),f=f.reduce((function(e,t){return e.concat(t)})),T&&(f=f.map((function(e){return"{"+e+"}"})));var y=[];for(i=0,a=f.length;i<a;i++)for(h=0,p=u.length;h<p;h++)y.push(f[i]+u[h]);return y},f.prototype.parse=function(e,t){var n=this.options;if(!n.noglobstar&&"**"===e)return i;if(""===e)return"";var r,o,a,E="",l=!!n.nocase,d=!1,f=[],p=!1,O=-1,N=-1,w="."===e.charAt(0)?"":n.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)";function m(){if(o){switch(o){case"*":E+=c,l=!0;break;case"?":E+=s,l=!0;break;default:E+="\\"+o}o=!1}}for(var T,y=0,g=e.length;y<g&&(T=e.charAt(y));y++)if(n.debug&&console.error("%s\t%s %s %j",e,y,E,T),d&&u[T])E+="\\"+T,d=!1;else switch(T){case"/":return!1;case"\\":m(),d=!0;continue;case"?":case"*":case"+":case"@":case"!":if(n.debug&&console.error("%s\t%s %s %j <-- stateChar",e,y,E,T),p){"!"===T&&y===N+1&&(T="^"),E+=T;continue}m(),o=T,n.noext&&m();continue;case"(":if(p){E+="(";continue}if(!o){E+="\\(";continue}r=o,f.push({type:r,start:y-1,reStart:E.length}),E+="!"===o?"(?:(?!":"(?:",o=!1;continue;case")":if(p||!f.length){E+="\\)";continue}switch(l=!0,E+=")",r=f.pop().type){case"!":E+="[^/]*?)";break;case"?":case"+":case"*":E+=r}continue;case"|":if(p||!f.length||d){E+="\\|",d=!1;continue}E+="|";continue;case"[":if(m(),p){E+="\\"+T;continue}p=!0,N=y,O=E.length,E+=T;continue;case"]":if(y===N+1||!p){E+="\\"+T,d=!1;continue}l=!0,p=!1,E+=T;continue;default:m(),d?d=!1:!u[T]||"^"===T&&p||(E+="\\"),E+=T}if(p){var I=e.substr(N+1),R=this.parse(I,h);E=E.substr(0,O)+"\\["+R[0],l=l||R[1]}for(;a=f.pop();){var S=E.slice(a.reStart+3);S=S.replace(/((?:\\{2})*)(\\?)\|/g,(function(e,t,n){return n||(n="\\"),t+t+n+"|"}));var P="*"===a.type?c:"?"===a.type?s:"\\"+a.type;l=!0,E=E.slice(0,a.reStart)+P+"\\("+S}m(),d&&(E+="\\\\");var D=!1;switch(E.charAt(0)){case".":case"[":case"(":D=!0}""!==E&&l&&(E="(?=.)"+E);D&&(E=w+E);if(t===h)return[E,l];if(!l)return function(e){return e.replace(/\\(.)/g,"$1")}(e);var b=n.nocase?"i":"",A=new RegExp("^"+E+"$",b);return A._glob=e,A._src=E,A};var h={};d.makeRe=function(e,t){return new f(e,t||{}).makeRe()},f.prototype.makeRe=function(){if(this.regexp||!1===this.regexp)return this.regexp;var e=this.set;if(!e.length)return this.regexp=!1;var t=this.options,n=t.noglobstar?c:t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",r=t.nocase?"i":"",o=e.map((function(e){return e.map((function(e){return e===i?n:"string"==typeof e?function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}(e):e._src})).join("\\/")})).join("|");o="^(?:"+o+")$",this.negate&&(o="^(?!"+o+").*$");try{return this.regexp=new RegExp(o,r)}catch(e){return this.regexp=!1}},d.match=function(e,t,n){var r=new f(t,n);return e=e.filter((function(e){return r.match(e)})),n.nonull&&!e.length&&e.push(t),e},f.prototype.match=function(e,t){if(this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;var n=this.options;"win32"===r&&(e=e.split("\\").join("/"));e=e.split(E),n.debug&&console.error(this.pattern,"split",e);for(var o=this.set,i=0,a=o.length;i<a;i++){var s=o[i];if(this.matchOne(e,s,t))return!!n.flipNegate||!this.negate}return!n.flipNegate&&this.negate},f.prototype.matchOne=function(e,t,n){var r=this.options;r.debug&&console.error("matchOne",{this:this,file:e,pattern:t}),r.matchBase&&1===t.length&&(e=a(e.join("/")).split("/")),r.debug&&console.error("matchOne",e.length,t.length);for(var o=0,s=0,c=e.length,u=t.length;o<c&&s<u;o++,s++){r.debug&&console.error("matchOne loop");var E,l=t[s],d=e[o];if(r.debug&&console.error(t,l,d),!1===l)return!1;if(l===i){r.debug&&console.error("GLOBSTAR",[t,l,d]);var f=o,h=s+1;if(h===u){for(r.debug&&console.error("** at the end");o<c;o++)if("."===e[o]||".."===e[o]||!r.dot&&"."===e[o].charAt(0))return!1;return!0}e:for(;f<c;){var p=e[f];if(r.debug&&console.error("\nglobstar while",e,f,t,h,p),this.matchOne(e.slice(f),t.slice(h),n))return r.debug&&console.error("globstar found match!",f,c,p),!0;if("."===p||".."===p||!r.dot&&"."===p.charAt(0)){r.debug&&console.error("dot detected!",e,f,t,h);break e}r.debug&&console.error("globstar swallow a segment, and continue"),f++}return!(!n||f!==c)}if("string"==typeof l?(E=r.nocase?d.toLowerCase()===l.toLowerCase():d===l,r.debug&&console.error("string match",l,d,E)):(E=d.match(l),r.debug&&console.error("pattern match",l,d,E)),!E)return!1}if(o===c&&s===u)return!0;if(o===c)return n;if(s===u)return o===c-1&&""===e[o];throw new Error("wtf?")}}));function x(){H||("undefined"!=typeof BroadcastChannel?H=new BroadcastChannel("PHOENIX_WATCH_EVENT_NOTIFICATION"):console.warn("window.BroadcastChannel not supported. File system watch events across tabs wont be synced."))}function V(e,t){if(t&&t.length>0)for(const n of t)if(K(e,n))return!0;return!1}function j(e,t=!0){t&&function(e){x(),H.postMessage(e)}(e);for(const t of B)!t.callback||(n=t.path,r=e.path,window.path.relative(n,r).startsWith(".."))||V(e.path,t.ignoreGlobList)||t.callback(e.event,e.parentDirPath,e.entryName,e.path);var n,r}function G(e,t){let n=window.path;e=n.normalize(e),j({event:t,parentDirPath:`${n.dirname(e)}/`,entryName:n.basename(e),path:e})}x(),H.onmessage=async function(e){console.log("External fs watch event: ",e.data),j(e.data,!1)};var X={watch:function(e,t,n,r){n&&B.push({path:e,ignoreGlobList:t,callback:n}),r()},unwatch:function(e,t){B=B.filter((function(t){return t.path!==e})),t()},unwatchAll:function(e){B=[],e()},reportUnlinkEvent:function(e){G(e,"deleted")},reportChangeEvent:function(e){G(e,"changed")},reportCreateEvent:function(e){G(e,"created")}},z=t.ERR_CODES,W=t.Errors;const q=z.ERROR_CODES;async function Q(e){return new Promise((async(t,n)=>{fs.stat(e,(async(e,r)=>{e&&e.code===q.ENOENT?t(null):e?n(e):t(r)}))}))}async function Z(e){return new Promise((async(t,n)=>{fs.mkdir(e,(async e=>{e&&e.code!==q.EEXIST?n(e):t()}))}))}async function J(e,t){return new Promise((async(n,r)=>{fs.readFile(e,(async(e,o)=>{e?r(e):fs.writeFile(t,o,(function(e){e?r(e):n()}))}))}))}async function ee(e,t){let n=await async function(e){return new Promise((async(t,n)=>{fs.readdir(e,(async(e,r)=>{e?n(e):t(r)}))}))}(e);for(let r of n){let n=`${e}/${r}`,o=`${t}/${r}`;(await Q(n)).isFile()?await J(n,o):(await Z(o),await ee(n,o))}}async function te(e,t,n,r=!0){try{let r=await Q(e);if(!r)return void n(new W.EIO(`Cannot copy src: ${e}`));r.isFile()?(await async function(e,t){let n=await Q(t);if(!n){let r=window.path.dirname(t),o=window.path.basename(t);if(n=await Q(r),n&&n.isDirectory()){let t=`${r}/${o}`;return void await J(e,t)}throw new W.EIO(`_copyFile Cannot create destination file: ${t}`)}let r=window.path.basename(e);if(!n||!n.isDirectory())throw n&&n.isFile()?new W.EEXIST(`_copyFile Destination file already exists: ${t}`):new W.EIO(`_copyFile Cannot copy file, unknown destination: ${e} to ${t}`);{let n=`${t}/${r}`;await J(e,n)}}(e,t),n(null)):r.isDirectory()&&(await async function(e,t){let n=await Q(t);if(n&&n.isFile())throw new W.EEXIST(`Destination file already exists: ${t}`);if(!n||!n.isDirectory())throw new W.ENONET(`Destination folder does not exist: ${t}`);await ee(e,t)}(e,t),n(null))}catch(r){n(new W.EIO(`${r}: Cannot copy src: ${e} to ${t}`))}}var ne,re,oe=function(e,t,n){te(window.path.normalize(e),window.path.normalize(t),n)},ie={},ae=ie={};function se(){throw new Error("setTimeout has not been defined")}function ce(){throw new Error("clearTimeout has not been defined")}function ue(e){if(ne===setTimeout)return setTimeout(e,0);if((ne===se||!ne)&&setTimeout)return ne=setTimeout,setTimeout(e,0);try{return ne(e,0)}catch(t){try{return ne.call(null,e,0)}catch(t){return ne.call(this,e,0)}}}!function(){try{ne="function"==typeof setTimeout?setTimeout:se}catch(e){ne=se}try{re="function"==typeof clearTimeout?clearTimeout:ce}catch(e){re=ce}}();var Ee,le=[],de=!1,fe=-1;function he(){de&&Ee&&(de=!1,Ee.length?le=Ee.concat(le):fe=-1,le.length&&pe())}function pe(){if(!de){var e=ue(he);de=!0;for(var t=le.length;t;){for(Ee=le,le=[];++fe<t;)Ee&&Ee[fe].run();fe=-1,t=le.length}Ee=null,de=!1,function(e){if(re===clearTimeout)return clearTimeout(e);if((re===ce||!re)&&clearTimeout)return re=clearTimeout,clearTimeout(e);try{re(e)}catch(t){try{return re.call(null,e)}catch(t){return re.call(this,e)}}}(e)}}function Oe(e,t){this.fun=e,this.array=t}function Ne(){}ae.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];le.push(new Oe(e,t)),1!==le.length||de||ue(pe)},Oe.prototype.run=function(){this.fun.apply(null,this.array)},ae.title="browser",ae.browser=!0,ae.env={},ae.argv=[],ae.version="",ae.versions={},ae.on=Ne,ae.addListener=Ne,ae.once=Ne,ae.off=Ne,ae.removeListener=Ne,ae.removeAllListeners=Ne,ae.emit=Ne,ae.prependListener=Ne,ae.prependOnceListener=Ne,ae.listeners=function(e){return[]},ae.binding=function(e){throw new Error("process.binding is not supported")},ae.cwd=function(){return"/"},ae.chdir=function(e){throw new Error("process.chdir is not supported")},ae.umask=function(){return 0};let we=null,me=null;function Te(e,t,n,r,o){const i=we.path.normalize(t).split("/");if(n=n||ie.umask(),(o=o||0)>=i.length)return r(null);var a=i.slice(0,o+1).join("/")||"/";e.stat(a,(function(i){null===i?Te(e,t,n,r,o+1):e.mkdir(a,n,(function(i){if(i&&"EEXIST"!==i.code)return r(i);Te(e,t,n,r,o+1)}))}))}function ye(e){for(let t=0;t<e.length;t++)if("function"==typeof e[t])return t;return-1}const ge={mountNativeFolder:async function(...e){return $.mountNativeFolder(...e)},readdir:function(...e){let t=e[0];return I.isMountPath(t)||I.isMountSubPath(t)?$.readdir(...e):we.fs.readdir(...e)},stat:function(...e){let t=e[0];return I.isMountSubPath(t)?$.stat(...e):we.fs.stat(...e)},readFile:function(...e){let t=e[0];return I.isMountSubPath(t)?$.readFile(...e):we.fs.readFile(...e)},writeFile:function(...e){let t=e[0];let n=ye(e);return-1!==n&&(e.originalCallback=e[n],e[n]=function(...n){(n.length>=1?n[0]:null)||X.reportChangeEvent(t),e.originalCallback&&e.originalCallback(...n)}),I.isMountSubPath(t)?$.writeFile(...e):we.fs.writeFile(...e)},mkdir:function(...e){let t=e[0];let n=ye(e);return-1!==n&&(e.originalCallback=e[n],e[n]=function(...n){(n.length>=1?n[0]:null)||X.reportCreateEvent(t),e.originalCallback&&e.originalCallback(...n)}),I.isMountSubPath(t)?$.mkdir(...e):we.fs.mkdir(...e)},rename:function(e,n,r){function o(...t){(t.length>=1?t[0]:null)||(X.reportUnlinkEvent(e),X.reportCreateEvent(n)),r&&r(...t)}if(I.isMountPath(e)||I.isMountPath(n))throw new t.Errors.EPERM("Mount root directory cannot be deleted.");return I.isMountSubPath(e)&&I.isMountSubPath(n)?$.rename(e,n,o):we.fs.rename(e,n,o)},unlink:function(e,n){function r(...t){(t.length>=1?t[0]:null)||X.reportUnlinkEvent(e),n&&n(...t)}if(I.isMountPath(e))throw new t.Errors.EPERM("Mount root directory cannot be deleted.");return I.isMountSubPath(e)?$.unlink(e,r):"string"==typeof e?me.rm(e,{recursive:!0},r):void r(new t.Errors.EINVAL("Invalid arguments."))},copy:function(e,n,r){function o(...e){(e.length>=1?e[0]:null)||X.reportCreateEvent(n),r&&r(...e)}if(I.isMountSubPath(e)&&I.isMountSubPath(n))return $.copy(e,n,o);if(!I.isMountSubPath(e)&&!I.isMountSubPath(n))return oe(e,n,o);throw new t.Errors.ENOSYS("Phoenix fs copy across filer and native not yet supported")},showSaveDialog:function(){throw new t.Errors.ENOSYS("Phoenix fs showSaveDialog function not yet supported.")},watch:function(...e){return X.watch(...e)},unwatch:function(...e){return X.unwatch(...e)},unwatchAll:function(...e){return X.unwatchAll(...e)},moveToTrash:function(){throw new t.Errors.ENOSYS("Phoenix fs moveToTrash function not yet supported.")},mkdirs:function(e,t,n,r){"boolean"!=typeof n&&(r=n,n=!1),"function"!=typeof r&&(r=function(){}),n?Te(ge,e,t,r):ge.mkdir(e,t,r)},BYTE_ARRAY_ENCODING:$.BYTE_ARRAY_ENCODING,ERR_NOT_FOUND:e(t).ERROR_CODES.ENOENT,ERR_EISDIR:e(t).ERROR_CODES.EISDIR,ERR_EINVAL:e(t).ERROR_CODES.EINVAL,ERR_FILE_EXISTS:e(t).ERROR_CODES.EEXIST};ge.copyFile=ge.copy})();
//# sourceMappingURL=fslib.js.map
